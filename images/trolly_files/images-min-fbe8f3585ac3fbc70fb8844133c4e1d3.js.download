(function(a,b){a.filterStorage={params:{imgs:"",filter:"",imgDetailIdx:"",init:function(e){var c={};var d=e;if(d!=undefined){b.each(d.replace("?","").split("&"),function(h,i){if(i.indexOf("=")>-1){var j=i.split("=");var g=(j[0]!==undefined)?j[0]:"";var f=(j[1]!==undefined)?j[1]:"";c[g]=f;}});}if(!String.prototype.isParamClean){String.prototype.isParamClean=function(){return !/</.test(this)&&!/>/.test(this)&&!/%3C/.test(this)&&!/%3E/.test(this);};}this.imgs="1p";if(c.imgs!==undefined&&c.imgs!==""&&c.imgs.isParamClean()){this.imgs=c.imgs;}this.filter="on";if(c.filter!==undefined&&c.filter!==""&&c.filter.isParamClean()){this.filter=c.filter;}}},setSizeFilter:function(c){if(c!==undefined){this.params.imgs=c;return this.imgs;}},getSizeFilter:function(){return this.params.imgs;},setFilter:function(c){if(c!==undefined){this.params.filter=c;return this.filter;}},getFilter:function(){return this.params.filter;},getParams:function(){var c="&imgs="+this.getSizeFilter()+"&filter="+this.getFilter();return c;},updateParams:function(c){c["imgs"]=this.getSizeFilter();c["filter"]=this.getFilter();if(window.imageDetail==true){c["imgDetail"]=true;}return c;},setImgDetailIdx:function(c){if(c!==undefined){this.params.imgDetailIdx=c;return this.imgDetailIdx;}},getImgDetailIdx:function(){if(this.params.imgDetailIdx!==""){return this.params.imgDetailIdx;}else{return undefined;}}},a.rebindDataOnSuccess=function(j){b(".img-detail-container").hide();b(".spinner-container").hide();if(j!=true){b("#pagination #pagination-nav-block").show();b("#pagination-nav-block").hide();}var d=History.getState();var i=d.url.substring(d.url.indexOf("?"),d.url.length);a.filterStorage.params.init(i);b(".filter-one").val(pictures.filterStorage.getSizeFilter());var h=b.cookie(APNGlobal.cookiePrefix+"-safeSearch");if(h==null||h==undefined){b(".filter-two").val(pictures.filterStorage.getFilter());}else{pictures.filterStorage.setFilter(h);b(".filter-two").val(h);}b(".filter-one").bind("change",function(){pictures.filterStorage.setSizeFilter(this.value);window.recordPartial.historyPush("imgs",a.filterStorage);firePixelWithoutBind(this,"navigational","centerRailMiddle","picSearch","sizeFilter","Click",pictures.filterStorage.getSizeFilter());});b(".filter-two").bind("change",function(){pictures.filterStorage.setFilter(this.value);window.recordPartial.historyPush("imgsafesearch",a.filterStorage);firePixelWithoutBind(this,"navigational","centerRailMiddle","picSearch","safeSearchFilter","Click",pictures.filterStorage.getFilter());b.apnCookie("safeSearch",b(this).val(),{expires:183});});b(".fname").click(function(k){k.preventDefault();});b(".pic-box-title").click(function(k){k.stopPropagation();});b(".algo-results").bind("click",function(){firePixelWithoutBind(this,"algo","centerRailMiddle","picSearch","picturesAlgo","Click");});b(".images-legal").bind("click",function(){firePixelWithoutBind(this,"static","centerRailMiddle","picSearch","copyRightLink","Click","algo");});b(".algo-img").on("click",function(){adsCtr=1;index=b(this).attr("data-param");window.imageDetail=true;window.recordPartial.historyPush("imageDetail",a.filterStorage);window.pictures.imageDetails.showImgDetail(index);});var g={minMargin:5,maxMargin:5,itemSelector:".algo-box",firstItemClass:"first-item",resize:true};if(b(".algo-content")){var f=0;var c=10;var e=setInterval(function(){if(b(".algo-content").width()){clearInterval(e);b(".algo-content").rowGrid(g);window.scrollTo(0,0);}f+=c;if(f>3000){clearInterval(e);}},c);window.scrollTo(0,0);}},a.imageDetails={showPrevImgDetail:function(d){firePixelWithoutBind(d,"navigational","centerRailMiddle","picSearch","imageDetailPrevNav","Click");index=b(".img-detail-prev-nav").attr("data-param");var c=parseInt(index)-1;a.imageDetails.showImgDetail(c);},showNextImgDetail:function(d){firePixelWithoutBind(d,"navigational","centerRailMiddle","picSearch","imageDetailNextNav","Click");index=b(".img-detail-next-nav").attr("data-param");var c=parseInt(index)+1;a.imageDetails.showImgDetail(c);},showImgDetail:function(c){pictures.filterStorage.setImgDetailIdx(c);window.scrollTo(0,0);b("#left-pane #image").addClass("img-detail-container");b("#left-pane #image").html(b("#"+"image"+c).html().replace(/_src/,"src"));b("#left-pane #image").show();b("#left-pane #topAdsLabel").hide();b("#left-pane #sponsoredTop").hide();b("#left-pane #pictures").hide();b(".img-detail-prev-nav").on("click",function(){a.imageDetails.showPrevImgDetail(this);});b(".img-detail-next-nav").on("click",function(){a.imageDetails.showNextImgDetail(this);});b(".img-detail-close").on("click",function(){firePixelWithoutBind(this,"navigational","centerRailMiddle","picSearch","imageDetailClose","Click");pictures.imageDetails.reshowLeftPane();});b(".copyright").on("click",function(){firePixelWithoutBind(this,"static","centerRailMiddle","picSearch","copyRightLink","Click","image-detail");});b(".img-details-url").on("click",function(){firePixelWithoutBind(this,"algo","centerRailMiddle","picSearch","imageDetailPic","Click");});var d=parseInt(c)-1;if(d>=1){b("#preload").html(b("#"+"image"+d).html().replace("img_holder","img"));}var e=parseInt(c)+1;if(b("#"+"image"+e).length>0){b("#preload").html(b("#"+"image"+e).html().replace("img_holder","img"));}},reshowLeftPane:function(){if(b("#left-pane #image").is(":visible")==true){window.imageDetail=false;b("#left-pane #image").hide();b("#left-pane #image").html("");b("#left-pane #topAdsLabel").show();b("#left-pane #sponsoredTop").show();b("#left-pane #pictures").show();b("#left-pane .algo-results").show();pictures.filterStorage.setImgDetailIdx("");window.scrollTo(0,0);}}};b(document).keydown(function(d){if(window.imageDetail&&!window.searchboxclicked){if(d.keyCode==39){d.preventDefault();var c=pictures.filterStorage.getImgDetailIdx();if(c!==undefined&&b("#image"+c+" a.img-detail-next-nav").length>0){a.imageDetails.showNextImgDetail(b("a.img-detail-next-nav")[c],c);}}else{if(d.keyCode==37){d.preventDefault();var c=pictures.filterStorage.getImgDetailIdx();if(c!==undefined&&c>0){a.imageDetails.showPrevImgDetail(b("a.img-detail-prev-nav")[c],c);}}}}});b("body").click(function(c){if(b(c.target).is("INPUT")){window.searchboxclicked=true;}else{window.searchboxclicked=false;}});}(window.pictures=window.pictures||{},jQuery));window._historyCounter=1;window.imageDetail=false;window.searchboxclicked=false;History.Adapter.bind(window,"statechange",function(){var a=History.getState();var b=a.url.substring(a.url.indexOf("?"),a.url.length);pictures.filterStorage.params.init(b);if(window.imageDetail){pictures.imageDetails.reshowLeftPane();}else{window.recordPartial.fetchSubBlocksOnPopState(""+"popstate","imagemain",window.pictures.filterStorage,window.pictures.rebindDataOnSuccess);}window.scrollTo(0,0);});(function(a,b){a.filterUrlBuilder={buildQueryString:function(e){var c={};b.each(window.location.search.replace("?","").split("&"),function(h,i){if(i.indexOf("=")>-1){var j=i.split("=");var g=(j[0]!==undefined)?j[0]:"";var f=(j[1]!==undefined)?j[1]:"";c[g]=f;}});e.updateParams(c);var d="";b.each(c,function(f,g){d=d+"&"+f+"="+g;});return d;},buildRelativeUrl:function(e){var c={};e.updateParams(c);var d="";b.each(c,function(f,g){d=d+"&"+f+"="+g;});return d;},buildFullUrl:function(d){var c=this.buildQueryString(d);return window.location.href.substring(0,window.location.href.indexOf("?"))+"?"+c;}},a.historyPush=function(c,d){if(typeof history.pushState==="undefined"){History.pushState(c,document.title,this.filterUrlBuilder.buildRelativeUrl(d));}else{History.pushState(c,document.title,this.filterUrlBuilder.buildFullUrl(d));}},a.fetchSubBlocksOnPopState=function(c,e,g,f){b(".spinner-container").show();var d=this.filterUrlBuilder.buildFullUrl(g)+"&bgid="+e+"&contentChannel=partial";PARTIAL.fetchBlocks({url:d,onSuccess:function(){b(".spinner-container").hide();if(f){f();}}});};}(window.recordPartial=window.recordPartial||{},jQuery));